<?php

use Illuminate\Support\Facades\Route;

// âœ… Use Statements à¸—à¸µà¹ˆà¹à¸à¹‰à¹à¸¥à¹‰à¸§ - à¸ˆà¸±à¸”à¸à¸¥à¸¸à¹ˆà¸¡à¸•à¸²à¸¡ Namespace
use App\Http\Controllers\{
    RegisterController,
    LoginController,
    DashboardController,
};

use App\Http\Controllers\Admin\{
    AdminProductController,
    AdminOrderController,
    AdminUserController,
    AdminReportController,
    AdminCategoryController,
    AdminBrandController,
};

use App\Http\Controllers\Client\{
    ClientProductController,
    CartController,
    CheckoutController,
    ReviewController,
};

use App\Http\Controllers\Account\{
    ProfileController,
    OrderController,
    WishlistController,
    SettingsController,
};

/*
|--------------------------------------------------------------------------
| Public Routes
|--------------------------------------------------------------------------
*/

Route::get('/', fn() => view('home'))->name('home');

/*
|--------------------------------------------------------------------------
| Guest Routes (à¸œà¸¹à¹‰à¸—à¸µà¹ˆà¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹„à¸”à¹‰ Login)
|--------------------------------------------------------------------------
*/

Route::middleware('guest')->group(function () {
    // Authentication
    Route::controller(LoginController::class)->group(function () {
        Route::get('/login', 'showLoginForm')->name('login');
        Route::post('/login', 'login')->name('login.post');
    });
    
    // Registration
    Route::controller(RegisterController::class)->group(function () {
        Route::get('/register', 'create')->name('register');
        Route::post('/register', 'store')->name('register.store');
        Route::post('/check-username', 'checkUsername')->name('check.username');
        Route::post('/check-email', 'checkEmail')->name('check.email');
    });
});

/*
|--------------------------------------------------------------------------
| Client Routes (à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡ Login à¸à¹‡à¹€à¸‚à¹‰à¸²à¹„à¸”à¹‰)
|--------------------------------------------------------------------------
*/

Route::prefix('product')->name('client.products.')->group(function () {
    Route::get('/', [ClientProductController::class, 'index'])->name('index');
    Route::get('/search', [ClientProductController::class, 'quickSearch'])->name('search');
    Route::get('/{id}', [ClientProductController::class, 'show'])->name('show');
});

/*
|--------------------------------------------------------------------------
| Static Pages (à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡ Login à¸à¹‡à¹€à¸‚à¹‰à¸²à¹„à¸”à¹‰)
|--------------------------------------------------------------------------
*/

Route::prefix('pages')->name('pages.')->group(function () {
    Route::view('/payment', 'pages.payment')->name('payment');
    Route::view('/contact', 'pages.contact')->name('contact');
    Route::view('/news', 'pages.news')->name('news');
    Route::view('/about', 'pages.about')->name('about');
    Route::view('/terms', 'pages.terms')->name('terms');
    Route::view('/privacy', 'pages.privacy')->name('privacy');
});

// Legacy redirects
Route::permanentRedirect('/payment', '/pages/payment');
Route::permanentRedirect('/contact', '/pages/contact');
Route::permanentRedirect('/news', '/pages/news');
Route::permanentRedirect('/profile', '/account/profile');

/*
|--------------------------------------------------------------------------
| Authenticated Routes (à¸•à¹‰à¸­à¸‡ Login à¸à¹ˆà¸­à¸™)
|--------------------------------------------------------------------------
*/

Route::middleware('auth')->group(function () {
    // Logout (à¸—à¸¸à¸à¸„à¸™à¹ƒà¸Šà¹‰à¹„à¸”à¹‰)
    Route::post('/logout', [LoginController::class, 'logout'])->name('logout');

    /*
    |----------------------------------------------------------------------
    | ðŸ”´ Admin Routes (à¹€à¸‰à¸žà¸²à¸° Admin à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™)
    |----------------------------------------------------------------------
    */
    Route::middleware(\App\Http\Middleware\RolesMiddleware::class . ':admin')
        ->prefix('admin')
        ->name('admin.')
        ->group(function () {
            
            // Dashboard
            Route::get('/dashboard', [DashboardController::class, 'index'])->name('dashboard');

            // ðŸ“¦ Product Management
            Route::resource('products', AdminProductController::class);

            // ðŸšš Order Management
            Route::prefix('orders')->name('orders.')->group(function () {
                Route::get('/', [AdminOrderController::class, 'index'])->name('index');
                Route::get('/{id}', [AdminOrderController::class, 'show'])->name('show');
                Route::patch('/{id}/status', [AdminOrderController::class, 'updateStatus'])->name('update-status');
            });

            // ðŸ‘¥ User Management
            Route::resource('users', AdminUserController::class);

            // ðŸ·ï¸ Category Management
            Route::resource('categories', AdminCategoryController::class);

            // ðŸ”– Brand Management
            Route::resource('brands', AdminBrandController::class);

            // ðŸ“Š Reports
            Route::prefix('reports')->name('reports.')->group(function () {
                Route::get('/', [AdminReportController::class, 'index'])->name('index');
                Route::get('/sales', [AdminReportController::class, 'sales'])->name('sales');
                Route::get('/products', [AdminReportController::class, 'products'])->name('products');
                Route::get('/customers', [AdminReportController::class, 'customers'])->name('customers');
            });
        });

    /*
    |----------------------------------------------------------------------
    | ðŸŸ¢ Member/Customer Routes (Member + Admin à¹€à¸‚à¹‰à¸²à¹„à¸”à¹‰)
    |----------------------------------------------------------------------
    */
    Route::middleware(\App\Http\Middleware\RolesMiddleware::class . ':member,admin')
        ->prefix('account')
        ->name('account.')
        ->group(function () {
            
            // ðŸ‘¤ Profile
            Route::get('/profile', [ProfileController::class, 'index'])->name('profile');
            Route::patch('/profile', [ProfileController::class, 'update'])->name('profile.update');

            // ðŸ“‹ Orders
            Route::prefix('orders')->name('orders.')->group(function () {
                Route::get('/', [OrderController::class, 'index'])->name('index');
                Route::get('/{id}', [OrderController::class, 'show'])->name('show');
                Route::delete('/{id}', [OrderController::class, 'cancel'])->name('cancel');
            });

            // â¤ï¸ Wishlist
            Route::get('/wishlist', [WishlistController::class, 'index'])->name('wishlist');
            Route::post('/wishlist/{productId}', [WishlistController::class, 'toggle'])->name('wishlist.toggle');

            // âš™ï¸ Settings
            Route::get('/settings', [SettingsController::class, 'index'])->name('settings');
            Route::patch('/settings', [SettingsController::class, 'update'])->name('settings.update');

            // ðŸ›’ Cart
            Route::prefix('cart')->name('cart.')->group(function () {
                Route::get('/', [CartController::class, 'index'])->name('index');
                Route::post('/add/{productId}', [CartController::class, 'add'])->name('add');
                Route::patch('/update/{itemId}', [CartController::class, 'update'])->name('update');
                Route::delete('/remove/{itemId}', [CartController::class, 'remove'])->name('remove');
            });

            // ðŸ’³ Checkout
            Route::prefix('checkout')->name('checkout.')->group(function () {
                Route::get('/', [CheckoutController::class, 'index'])->name('index');
                Route::post('/process', [CheckoutController::class, 'process'])->name('process');
                Route::get('/success/{orderId}', [CheckoutController::class, 'success'])->name('success');
            });
        });

    /*
    |----------------------------------------------------------------------
    | ðŸ“Š Dashboard Redirect (Auto-redirect à¸•à¸²à¸¡ Role)
    |----------------------------------------------------------------------
    */
    Route::get('/dashboard', function () {
        $roleName = strtolower(auth()->user()->role?->role_name ?? 'member');
        
        return match($roleName) {
            'admin' => redirect()->route('admin.dashboard'),
            default => redirect()->route('account.profile')
        };
    })->name('dashboard');
});

/*
|--------------------------------------------------------------------------
| API Routes (Optional)
|--------------------------------------------------------------------------
*/

Route::prefix('api')->name('api.')->group(function () {
    Route::get('/products/featured', [ClientProductController::class, 'getFeatured'])->name('products.featured');
});

/*
|--------------------------------------------------------------------------
| Fallback Route (404 Page)
|--------------------------------------------------------------------------
*/

Route::fallback(function () {
    return response()->view('errors.404', [], 404);
});
